!function(){"use strict";if("undefined"!=typeof window&&void 0===window.vismeForms){let e={constants:{mode:{INLINE:"inline",FULL_PAGE:"fullPage"}},forms:[],flags:{isInitialized:!1,isInitOnReadyFired:!1,shouldBeShown:!1,shouldBePreloaded:!1},initOnReady(){e.flags.isInitOnReadyFired||e.onInit(window,e.init)},onInit(t,s){if(t.document&&("complete"===t.document.readyState||"interactive"===t.document.readyState)){s();return}e.addEvent(t,"load",s),t.document&&(e.addEvent(t.document,"DOMContentLoaded",s),e.addEvent(t.document,"readystatechange",function(){"complete"===t.document.readyState&&s()}))},init(){e.flags.isInitialized||(e.flags.isInitialized=!0,e.setupVisme(),e.addEvent(window,"message",e.onMessageHandler,!1))},getWidth:e=>e?"100vw":"100%",getHeight:e=>e?"100vh":"100%",getStyle(e){let t="border: none; max-width: 100vw; ";return e&&(t+="position: fixed; z-index: 999999; top: 0; left: 0; background: rgba(255, 255, 255, 0.78); "),t},async getPopupSettings({vismeDiv:e,formId:t,origin:s}){if(t&&s){let e=await fetch(`${s}/ajax/forms/settings/${t}?type=fullPage`),i=await e.json();if(i?.settings)return JSON.parse(i.settings)}else console.warn("VISME_FORMS: Popup settings are not loaded. Please update your embed code.");if(e.getAttribute("data-trigger-page-load"))return{afterPageLoad:!0};if(e.getAttribute("data-trigger-user-interaction"))return{afterUserInteraction:!0};let i=parseInt(e.getAttribute("data-trigger-scroll"));if(!Number.isNaN(i))return{afterScrollDown:i};if(e.getAttribute("data-trigger-leave"))return{beforeLeave:!0};let r=parseInt(e.getAttribute("data-trigger-timer"));return Number.isNaN(r)?null:{afterTime:r}},addOnUserInteractionListener(t,s){let i=()=>{if(e.flags[s]){console.warn("VISME_FORMS: onUserInteraction callback already fired");return}t(),e.flags[s]=!0};["keydown","mousedown","mousemove","touchmove","touchstart","touchend","wheel"].forEach(e=>{document.addEventListener(e,i,{once:!0})})},popupHandlers:{onAfterTime(e,t){setTimeout(()=>{t()},1e3*e)},onPageScroll(e,t){let s=document.documentElement.scrollHeight-window.innerHeight;s<=0?t():(e=>{let i=e/100*s,r=()=>{window.scrollY>=i&&(t(),window.removeEventListener("scroll",r))};window.addEventListener("scroll",r)})(e)},onUserInteraction(t){e.addOnUserInteractionListener(t,"shouldBeShown")},onPageLeave(e){document.body.addEventListener("mouseleave",e,{once:!0})}},setPopupListener(t,s){let i=t.settings;if(i?.afterPageLoad||!i){s();return}let{afterUserInteraction:r,afterScrollDown:o,beforeLeave:n,afterTime:a}=i,{popupHandlers:d}=e;a?d.onAfterTime(a,s):o?d.onPageScroll(o,s):r?d.onUserInteraction(s):n&&d.onPageLeave(s)},defineEmbedMode(t){let{INLINE:s,FULL_PAGE:i}=e.constants.mode;return"true"===t.getAttribute("data-full-page")?i:s},loadPopup(t){e.createIframe(t,!0),e.setPopupListener(t,()=>{let s=e.getFormByIframeId(t.iframeId);if(!s.ref){console.warn("VISME_FORMS: form.ref not found");return}s.ref.style.opacity=1,s.ref.style.zIndex=999999,s.ref.contentWindow.postMessage({type:"vismeForms:play",id:t.formId},"*"),e.increaseNumberOfVisits(t.formId),e.updateLastVisit(t.formId)})},async getVismeDivsForSetup(){let t=document.getElementsByClassName("visme_d"),s=[],i=1;for(let r of t){let t=r.getAttribute("data-form-id")||"",o="true"===r.getAttribute("data-full-page"),n=e.getOrigin(r),a=e.defineEmbedMode(r),d={vismeDiv:r,width:e.getWidth(o),height:e.getHeight(o),style:e.getStyle(o),origin:n,formId:t,mode:a,iframeId:i,settings:null},l=s.some(e=>e.formId===t)&&a===e.constants.mode.FULL_PAGE;t&&!l&&(s.push(d),e.forms.push({formId:t,ref:null,mode:a,iframeId:i}),i++)}for(let t of s)if(t.mode===e.constants.mode.FULL_PAGE){let{vismeDiv:s,formId:i,origin:r}=t,o=await e.getPopupSettings({vismeDiv:s,formId:i,origin:r});t.settings=o||null}return s},async setupVisme(){(await e.getVismeDivsForSetup()).forEach(async t=>{let s=t.mode===e.constants.mode.FULL_PAGE,i=!0;if(t.settings?.showing)switch(t.settings.showing.type){case"everySession":i=!window.sessionStorage.getItem(`vismeforms_${t.formId}_closed`);break;case"submission":i=!window.localStorage.getItem(`vismeforms_${t.formId}_submitted`);break;case"closingForm":i=!window.localStorage.getItem(`vismeforms_${t.formId}_closed`);break;case"visit":i=e.getNumberOfVisits(t.formId)<t.settings.showing.value;break;case"onceEvery":{let e=parseInt(window.localStorage.getItem(`vismeforms_${t.formId}_lastVisit`))||0,[s,r]=t.settings.showing.value.split("*");e&&s&&r&&(i=Date.now()>e+parseInt(s)*({hours:36e5,days:864e5,weeks:6048e5})[r])}}if(s&&!i){console.warn("VISME_FORMS: Full page form not shown because of showing settings");return}e.addOnUserInteractionListener(()=>{s?e.loadPopup(t):e.createIframe(t)},`shouldBePreloaded-${t.mode}-${t.iframeId}`)})},getOrigin(e){let t=e.getAttribute("data-domain")||"my";return`https://${t}.visme.co`},addEvent(e,t,s){e.addEventListener&&e.addEventListener(t,s,!1)},getFormByIframeId:t=>e.forms.find(e=>e.iframeId===t),getFormByIdAndMode:(t,s)=>e.forms.find(e=>e.formId===t&&e.mode===s),createIframe({vismeDiv:t,width:s,height:i,style:r,iframeId:o,mode:n,origin:a},d=!1){let l=e.getFormByIframeId(o);if(!l||l.ref)return;let m=document.createElement("IFRAME"),f="/formsPlayer/_embed/"+t.getAttribute("data-url")+"?embedIframeId="+o;m.style.cssText=r,m.style.minHeight=t.getAttribute("data-min-height"),m.style.width=s,m.style.height=i,m.style.border="none",d&&(m.style.transition="opacity 0.2s",m.style.opacity=0,m.style.zIndex=-999),m.setAttribute("webkitallowfullscreen",!0),m.setAttribute("mozallowfullscreen",!0),m.setAttribute("allowfullScreen",!0),m.setAttribute("scrolling","no"),m.setAttribute("src",a+f),m.setAttribute("title",t.getAttribute("data-title")),n===e.constants.mode.INLINE&&m.setAttribute("loading","lazy"),m.className="vismeForms",t.parentNode.replaceChild(m,t),l.ref=m},onMessageHandler(t){if(-1===t.origin.indexOf("visme"))return;let s=t.data.type,i=t.data.id;if("vismeForms:shouldClose"===s){let t=e.getFormByIdAndMode(i,e.constants.mode.FULL_PAGE);t?.ref.parentNode.removeChild(t.ref),window.sessionStorage.setItem(`vismeforms_${i}_closed`,"true"),window.localStorage.setItem(`vismeforms_${i}_closed`,"true")}if("vismeForms:submitSuccess"===s&&window.localStorage.setItem(`vismeforms_${i}_submitted`,"true"),"vismeForms:formRectUpdated"===s){let s=e.getFormByIframeId(parseInt(t.data.iframeId));if(!s||s.iframeSizeAdjusted)return;let i=JSON.parse(t.data.data.formRect);s.ref.style.minHeight=Math.min(Math.max(i.height,500),600)+Number(t.data.data.badgeHeight)+"px",s.iframeSizeAdjusted=!0}if("vismeForms:redirectUser"===s){let{url:e}=t.data;window.location.href=e}},getNumberOfVisits:e=>parseInt(window.localStorage.getItem(`vismeforms_${e}_visits`))||0,increaseNumberOfVisits(t){let s=e.getNumberOfVisits(t);window.localStorage.setItem(`vismeforms_${t}_visits`,s+1)},updateLastVisit(e){window.localStorage.setItem(`vismeforms_${e}_lastVisit`,Date.now())}};window.vismeForms=e,e.initOnReady()}}();